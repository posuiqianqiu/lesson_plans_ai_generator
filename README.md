# 教案AI生成器

这是一个为高职院校教师开发的智能教案生成工具，提供命令行和Web界面两种使用方式，利用本地AI技术批量生成整学期教案，显著提升备课效率。

## 目录

- [功能特点](#功能特点)
- [项目架构](#项目架构)
- [快速开始](#快速开始)
- [使用指南](#使用指南)
- [文件格式要求](#文件格式要求)
- [工具使用](#工具使用)
- [故障排除](#故障排除)
- [常见问题](#常见问题)

## 功能特点

- **效率提升**：将教案编写时间从数小时缩短到几分钟
- **批量处理**：一键生成整学期所有课程教案
- **Web界面**：提供直观的图形界面，支持拖拽上传、实时进度显示
- **高度可配**：支持通过环境变量轻松切换本地大模型
- **数据安全**：完全本地化部署，确保教学数据的安全和隐私
- **高职适配**：针对职业技能教育特点优化内容生成

## 项目架构

```
教案AI生成器/
├── ai_generator.py          # AI内容生成核心模块
├── data_parser.py           # 数据解析模块
├── document_builder.py      # 文档构建模块
├── main.py                  # 命令行入口
├── start_web.py            # Web服务启动脚本
├── start_web.bat           # Windows快速启动脚本
├── web/                     # Web界面相关
│   ├── app.py              # FastAPI应用主文件
│   ├── static/             # 静态资源
│   └── templates/          # HTML模板
├── test_data/               # 测试数据目录
├── lesson_plans/            # 生成结果目录
├── cache/                   # 缓存目录
├── clean_test_files.py     # 测试文件清理工具
├── check_ollama.py         # Ollama连接检查工具
├── create_test_excel.py    # 测试数据生成工具
└── requirements.txt         # Python依赖列表
```

### 核心模块说明

- **ai_generator.py**：负责与Ollama API交互，生成教案内容
- **data_parser.py**：解析Excel教学进度表和Word文档
- **document_builder.py**：构建最终的Word教案文档
- **web/app.py**：提供Web界面和API服务

## 快速开始

三步即可开始使用：

1. **安装Ollama**：
   ```bash
   # 下载并安装Ollama
   # 访问 https://ollama.com/
   
   # 启动Ollama服务
   ollama serve
   
   # 下载推荐模型
   ollama pull qwen3:1.7b
   ```

2. **启动Web界面**：
   ```bash
   # Windows用户双击运行
   start_web.bat
   
   # 或使用Python命令
   python start_web.py
   ```

3. **开始生成**：
   - 打开浏览器访问：http://localhost:8000
   - 上传教学进度表（Excel格式）
   - 点击"开始生成教案"
   - 下载生成的教案文件

> 💡 **提示**：首次使用建议阅读[使用指南](#使用指南)了解详细步骤和最佳实践。

## 使用指南

本项目提供直观的Web界面，让教案生成变得简单高效。只需几个简单步骤即可开始使用。

### 第一步：环境准备

#### 1.1 安装Python
- 下载并安装Python 3.8或更高版本
- 推荐使用Python 3.11以获得最佳性能
- 下载地址：https://www.python.org/downloads/

#### 1.2 安装Ollama
1. **下载Ollama**：
   - 访问 https://ollama.com/
   - 下载适合您操作系统的版本（Windows/macOS/Linux）

2. **安装Ollama**：
   - Windows：运行下载的.exe安装程序
   - macOS：拖拽到应用程序文件夹
   - Linux：按照官网说明执行安装命令

3. **启动Ollama服务**：
   ```bash
   ollama serve
   ```
   服务启动后会显示 "Ollama is running"

4. **下载AI模型**：
   ```bash
   ollama pull qwen3:1.7b
   ```
   推荐模型：
   - `qwen3:1.7b`：轻量级，速度快，适合大多数场景
   - `qwen:7b`：更高质量，需要更多内存
   - `llama3:8b`：英文能力强，中英文混合场景

5. **验证安装**：
   - 访问 http://localhost:11434
   - 页面显示 "Ollama is running" 表示安装成功
   - 运行 `ollama list` 查看已下载的模型

#### 1.3 安装项目依赖
在项目根目录打开命令行，运行：
```bash
pip install -r requirements.txt
```

### 第二步：启动Web界面

#### 2.1 Windows用户（推荐）
双击项目根目录中的 `start_web.bat` 文件，系统会自动：
- 检查Python环境
- 启动Web服务
- 打开浏览器访问 http://localhost:8000

#### 2.2 手动启动
在命令行中运行：
```bash
python start_web.py
```

#### 2.3 验证启动成功
- 看到 "Uvicorn running on http://0.0.0.0:8000" 表示启动成功
- 在浏览器中访问 http://localhost:8000
- 页面正常显示教案生成器界面

### 第三步：准备文件

#### 3.1 必需文件：教学进度表
**文件格式**：Excel (.xlsx 或 .xls)
**必需列名**：
- 周次：教学周次（1, 2, 3...）
- 课次：每周的第几次课（1, 2...）
- 日期：上课日期（2024-02-26）
- 星期：星期几（星期一）
- 节次：上课节次（1-2节）
- 班级：教学班级（计算机应用技术1班）
- 课程名称：课程名称（Python程序设计）
- 教学内容：本次课教学内容（变量与数据类型）
- 教学地点：上课地点（实训楼302）
- 备注：其他信息（理论课）

**示例文件**：
项目提供了 `test_data/schedule.xlsx` 作为参考模板。

#### 3.2 可选文件：教学大纲
**文件格式**：Word (.docx)
**内容建议**：
- 课程基本信息
- 教学目标
- 教学内容概要
- 考核方式
- 教材信息

**作用**：为AI生成提供更准确的课程背景信息。

#### 3.3 可选文件：教案模板
**文件格式**：Word (.docx)
**必需占位符**：
- `{单元教学目标}`
- `{教学重点}`
- `{教学难点}`
- `{教学活动}`
- `{作业布置}`
- `{教学资源}`
- `{教学反思}`
- `{教学评价}`

**自定义**：可以根据学校要求修改模板格式和样式。

### 第四步：使用Web界面

#### 4.1 文件上传
1. **上传教学进度表**：
   - 点击"选择文件"按钮
   - 选择Excel文件
   - 系统自动验证文件格式

2. **上传教学大纲（可选）**：
   - 点击"选择教学大纲文件"
   - 选择Word文件
   - 提升生成质量

3. **上传教案模板（可选）**：
   - 点击"选择教案模板文件"
   - 选择Word文件
   - 自定义教案格式

#### 4.2 配置参数
1. **周次范围**：
   - 默认：全部周次
   - 自定义：如"1-8"表示前8周
   - 作用：控制生成数量

2. **高级选项**：
   - 并发数量：同时生成的教案数量
   - 超时时间：单个教案生成超时设置

#### 4.3 开始生成
1. 点击"开始生成教案"按钮
2. 系统显示进度条和当前状态
3. 实时查看生成进度：
   - "正在解析教学进度表..."
   - "正在生成第X周第Y次课教案..."
   - "教案生成完成！"

#### 4.4 下载结果
1. 生成完成后，页面显示"下载教案"按钮
2. 点击下载所有生成的教案
3. 教案文件保存在 `lesson_plans` 目录中
4. 文件命名格式：`第X周第Y次课教案.docx`

### 第五步：结果管理

#### 5.1 查看生成结果
- 所有教案保存在 `lesson_plans` 文件夹
- 按周次和课次自动命名
- 支持直接在Word中编辑修改

#### 5.2 批量操作
- 可以批量打印所有教案
- 支持批量转换为PDF
- 可以按班级或课程分类整理

#### 5.3 质量优化
如果对生成质量不满意，可以：
1. 提供更详细的教学大纲
2. 优化教案模板结构
3. 调整AI模型参数
4. 分批生成，逐步优化

## 文件格式要求

### 教学进度表（schedule.xlsx）

**必需文件**，包含课程安排信息：

| 列名 | 说明 | 示例 |
|------|------|------|
| 周次 | 教学周次 | 1, 2, 3... |
| 课次 | 每周的第几次课 | 1, 2... |
| 日期 | 上课日期 | 2024-02-26 |
| 星期 | 星期几 | 星期一 |
| 节次 | 上课节次 | 1-2节 |
| 班级 | 教学班级 | 计算机应用技术1班 |
| 课程名称 | 课程名称 | Python程序设计 |
| 教学内容 | 本次课教学内容 | 变量与数据类型 |
| 教学地点 | 上课地点 | 实训楼302 |
| 备注 | 其他信息 | 理论课 |

**格式要求：**
- 文件格式：.xlsx 或 .xls
- 编码：UTF-8
- 必须包含上述所有列名

### 教学大纲（syllabus.docx）

**可选文件**，提供课程总体信息：

- 课程基本信息
- 教学目标
- 教学内容概要
- 考核方式
- 教材信息

**格式要求：**
- 文件格式：.docx
- 编码：UTF-8
- 结构清晰，段落分明

### 教案模板（template.docx）

**可选文件**，定义教案格式：

- 包含占位符：`{单元教学目标}`、`{教学重点}`、`{教学难点}`等
- 标准教案格式结构
- 学校要求的固定格式

**格式要求：**
- 文件格式：.docx
- 编码：UTF-8
- 包含必要的占位符

## 工具使用

### 测试文件清理工具

项目提供了 `clean_test_files.py` 脚本，用于安全清理测试文件：

**基本用法：**
```bash
# 清理当前目录的测试文件
python clean_test_files.py

# 清理指定目录
python clean_test_files.py --root /path/to/project

# 不创建备份直接删除
python clean_test_files.py --no-backup
```

**功能特性：**
- 智能识别必要文件（包含标记、被导入的文件等）
- 自动备份功能（可选）
- 详细的操作报告
- 用户确认机制

**保护机制：**
- 包含 `# NECESSARY`、`# KEEP` 或 `# DO NOT DELETE` 标记的文件
- 被其他文件导入的测试文件
- 配置文件（pytest.ini、conftest.py等）
- 包含工具函数的文件

### Ollama连接检查工具

使用 `check_ollama.py` 检查Ollama服务状态：

```bash
python check_ollama.py
```

### 测试数据生成工具

使用 `create_test_excel.py` 生成示例测试数据：

```bash
python create_test_excel.py
```

## 故障排除

### 常见问题

**1. Ollama连接失败**
```
错误: 无法连接到Ollama服务
```
**解决方案：**
- 确保Ollama服务正在运行：`ollama serve`
- 检查端口：访问 http://localhost:11434
- 确保模型已下载：`ollama list`

**2. 文件解析错误**
```
错误: 文件格式不正确
```
**解决方案：**
- 检查Excel文件是否包含必需的列
- 确保文件编码为UTF-8
- 验证Word文件格式正确

**3. Web界面无法访问**
```
错误: 连接被拒绝
```
**解决方案：**
- 检查端口8000是否被占用
- 确保防火墙允许该端口
- 重新启动Web服务

**4. 生成速度慢**
**可能原因：**
- Ollama模型过大
- 系统资源不足
- 网络连接问题

**解决方案：**
- 使用较小的模型（如qwen3:1.7b）
- 关闭其他占用资源的程序
- 检查系统内存使用情况

**5. 生成内容质量不佳**
**优化建议：**
- 提供更详细的教学大纲
- 使用更高质量的教案模板
- 调整生成参数（如温度设置）

### 性能优化

**大文件处理：**
- 分批处理大量课程数据
- 增加系统内存
- 使用SSD存储

**批量操作：**
- 使用周次范围限制生成数量
- 并行处理多个班级
- 定期清理缓存文件

### 日志查看

**Web服务日志：**
- 控制台输出显示实时日志
- 检查 `web/uploads` 目录状态
- 查看 `lesson_plans` 生成结果

**命令行日志：**
- 运行时显示详细进度
- 错误信息包含具体位置
- 使用 `-v` 参数获取更多信息

### 环境变量配置

**Ollama配置：**
```bash
# Windows
set OLLAMA_MODEL=qwen3:1.7b
set OLLAMA_HOST=http://localhost:11434

# Linux/macOS
export OLLAMA_MODEL=qwen3:1.7b
export OLLAMA_HOST=http://localhost:11434
```

**高级配置：**
- `OLLAMA_TIMEOUT`: 请求超时时间
- `OLLAMA_MAX_RETRIES`: 最大重试次数
- `CACHE_DIR`: 缓存目录路径

## 常见问题

**Q: 支持哪些AI模型？**
A: 支持Ollama平台的所有模型，推荐使用qwen3:1.7b、qwen:7b等中文模型。

**Q: 可以离线使用吗？**
A: 是的，完全本地化部署，无需网络连接（除初始模型下载外）。

**Q: 生成的教案可以修改吗？**
A: 可以，所有生成的教案都是标准Word格式，可随意编辑修改。

**Q: 如何备份生成的教案？**
A: 建议定期备份 `lesson_plans` 目录，或使用云同步工具。

**Q: 支持多语言吗？**
A: 主要针对中文教学设计，英文支持取决于所选模型能力。

**Q: 如何自定义教案格式？**
A: 修改模板文件中的占位符和格式，系统会自动适配。

**Q: 系统要求是什么？**
A: 
- Python 3.8+
- 8GB+ RAM（推荐16GB）
- 10GB+ 可用磁盘空间
- 支持的操作系统：Windows 10+、macOS 10.14+、Linux

**Q: 如何获得技术支持？**
A: 查看项目文档、提交Issue或联系开发团队。

---

## 许可证

本项目采用 MIT 许可证，详见 [LICENSE](LICENSE) 文件。

## 贡献

欢迎提交 Issue 和 Pull Request 来改进项目。

## 更新日志

### v1.0.0
- 初始版本发布
- 支持Web界面使用方式
- 集成Ollama本地AI模型
- 提供完整的教案生成流程